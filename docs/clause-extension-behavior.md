# 文節伸縮・選択仕様

本ドキュメントは、Akaza における文節の伸縮操作（Shift+→ / Shift+←）と
文節選択（← / →）の**実装仕様**をまとめたものです。
実装の挙動を基準として記述しています。

## 用語

- **文節**: 変換候補が提示される単位（例: `わたし｜は｜がっこう`）
- **選択中の文節**: カーソル/ハイライトが当たっている文節
- **読み（かな）**: 変換対象となる文字列（ひらがな）

## 文節伸縮（Shift+→ / Shift+←）

1. Shift+→ は **選択中の文節の読みを右へ1文字伸ばす**。
2. Shift+← は **選択中の文節の読みを左へ1文字伸ばす**。
3. 文節の伸縮に伴って **隣接文節は逆方向に1文字縮む**。
4. 伸縮後も **選択中の文節のフォーカスは維持**する。

## 文節選択（← / →）

1. ← / → は **選択中の文節を左右に移動**する。
2. 文節が2つ以上ある場合、押下ごとに **必ず選択が変わる**。
3. 端に到達した場合は **反対側に回り込む**（ラップする）。
4. 文節が0または1の場合、選択は変わらない。

## 例

### 右に伸ばす（Shift+→）

入力: `わたしはがっこう`  
初期: `わたし｜は｜がっこう`

- 選択: `わたし`  
  Shift+→ 1回: `わたしは｜がっこう`  
  （次の文節「は」から1文字移動）

- 選択: `は`  
  Shift+→ 1回: `わたしはが｜っこう`  
  （次の文節「がっこう」から1文字移動）

### 左に伸ばす（Shift+←）

入力: `わたしはがっこう`  
初期: `わたし｜は｜がっこう`

- 選択: `は`  
  Shift+← 1回: `わた｜しは｜がっこう`  
  （左の文節「わたし」から末尾1文字を移動）

- 選択: `がっこう`  
  Shift+← 1回: `わたし｜はが｜っこう`

## 端の挙動

- 右端の文節で Shift+→ を押しても、文節構成は変化しない。
- 左端の文節で Shift+← を押しても、文節構成は変化しない。

## 例外/注意点

- 伸縮によって **隣接文節が消滅**する場合は、文節数が減る。
- サロゲートやマルチバイト文字は **1文字単位**で扱う。
- 変換候補が空の場合は **現状維持**とする。
